{
  "name": "blake",
  "description": "Simple, blog aware infrastructure to generate static sites",
  "version": "0.6.5",
  "homepage": "http://michaelnisi.github.com/blake/",
  "repository": {
    "type": "git",
    "url": "git://github.com/michaelnisi/blake.git"
  },
  "keywords": [
    "blog",
    "static",
    "site",
    "generator",
    "infrastructure"
  ],
  "main": "index.js",
  "bin": {
    "blake": "bin/cli.js"
  },
  "directories": {
    "lib": "lib",
    "example": "example",
    "test": "test"
  },
  "scripts": {
    "test": "tap test/*.js"
  },
  "dependencies": {
    "mkdirp": "0.3.x",
    "fstream": "0.1.x",
    "lru-cache": "2.1.x",
    "prettydate": "0.0.x",
    "event-stream": "3.0.x",
    "cop": "0.2.x",
    "popfun": "0.1.x"
  },
  "devDependencies": {
    "tap": "0.3.x",
    "rimraf": "2.0.x",
    "jade": "0.27.x",
    "markdown": "0.4.x"
  },
  "engines": {
    "node": ">=0.6.0"
  },
  "license": "MIT",
  "author": {
    "name": "Michael Nisi",
    "email": "michael.nisi@gmail.com",
    "url": "http://michaelnisi.com"
  },
  "readme": "# blake - generate site\n\n[![Build Status](https://secure.travis-ci.org/michaelnisi/blake.png)](http://travis-ci.org/michaelnisi/blake)\n\n## Description\n\nThe blake node module provides a simple, blog aware infrastructure to generate static sites. For unrestricted choice of input formats and template languages, blake confines itself to IO and template routing; it delegates file generation to user-written functions.\n\n## CLI Usage\n\n    blake source_directory target_directory\n    blake source_directory target_directory source_file ...\n\nIn the first synopsis form, blake writes all files generated from input data in the `source_directory` to the `target_directory`. In the second synopsis form, output is generated from the specified source files only.\n\n## Library Usage\n\n### Generate from directory\n\n    var blake = require('blake')\n      , source = 'blake-site'\n      , target = '/tmp/blake-site'\n      , join = require('path').join\n      , Reader = require('fstream').Reader\n      , props = { path:join(source, 'data') }\n      , cop = require('cop')\n\n    new Reader(props)\n      .pipe(cop('path'))\n      .pipe(blake(source, target))\n      .pipe(cop(function (filename) { return filename + '\\n' }))\n      .pipe(process.stdout)\n\n### Copy static resources and generate from directory\n\n    var blake = require('blake')\n      , source = 'blake-site'\n      , target = '/tmp/blake-site'\n      , join = require('path').join\n      , Reader = require('fstream').Reader\n      , props = { path:join(source, 'data') }\n      , cop = require('cop')\n      , copy = require('blake/lib/copy.js')\n\n    copy(join(source, 'resources'), target)\n      .on('error', console.error)\n      .on('end', function () {\n        new Reader(props)\n          .pipe(cop('path'))\n          .pipe(blake(source, target))\n          .pipe(cop(function (filename) { return filename + '\\n' }))\n          .pipe(process.stdout)\n      })\n\n### Generate from files\n\n    var blake = require('blake')\n      , cop = require('cop')\n      , readArray = require('event-stream').readArray\n      , filenames = ['first/file', 'second/file', 'third/file']\n      , source = 'source_directory'\n      , target = 'target_directory'\n \n    readArray(filenames)\n      .pipe(blake(source, target))\n      .pipe(cop(function (filename) { return filename + '\\n' }))\n      .pipe(process.stdout)\n\n### Generate and push to S3\n\nSince blake returns a Stream that emits the paths of the generated artifacts, we can pipe to [pushup](https://github.com/michaelnisi/pushup), and upload the files directly to S3.\n\n    var resolve = require('path').resolve\n      , cop = require('cop')\n      , getProps = require('pushup/lib/getProps')\n      , blake = require('blake')\n      , pushup = require('pushup')\n      , Reader = require('fstream').Reader\n      , sep = require('path').sep\n      , source = 'source_directory'\n      , target = '/tmp/target_directory'\n      , reader = new Reader({ path:resolve(source, 'data') })\n      , props = getProps()\n\n    process.chdir(target)\n      \n    reader\n      .pipe(cop('path'))\n      .pipe(blake(source, target))\n      .pipe(cop(adjustPath))\n      .pipe(pushup(props))\n      .pipe(process.stdout)\n\n    function adjustPath (p) {\n      return p.split(sep).slice(3).join(sep)\n    }\n\n## Events\n\nThe blake function returns a readable and writable [Stream](http://nodejs.org/api/stream.html) that emits following events:\n\n### Event: 'data'\n\n    function (path) { }\n\nThe `data` event emits paths of generated artifacts.\n\n### Event: 'end'\n\n    function () { }\n\nEmitted when blake is done.\n\n### Event: 'error'\n\n    function (err) { }\n\nEmitted if an error occured.\n\n## Configuration\n\nblake requires a configuration module at `source_directory/config.js`, which exports `paths`, and `views`, a map of generator functions:\n\n    exports.paths = {\n      data: 'data' \n    , templates: 'templates'\n    , resources: 'resources'\n    , posts: 'data/posts'\n    }\n\n    exports.views = {\n      'rss.jade': require('./rss.js')\n    , 'article.jade': require('./article.js')\n    , 'home.jade': require('./home.js')\n    , 'about.jade': require('./about.js')\n    , 'archive.jade': require('./archive.js')\n    }\n\nThe `paths` object defines input paths, with two required directories: `data` and `templates`. From `data` blake loads general input data, `templates` is the directory for templates. The two optional directories are `resources` and `posts`. The content of `resources` is copied to the `target_directory' unchanged. The `posts` directory hosts blog posts.\n\nThe `views` object is a map of user-written functions that implement the actual generation of output artifacts. Here, these functions are mapped by template name. \n\n## Input\n\nAt the top of each input file blake expects a JSON string that is interpreted as header providing transformation parameters. Besides it can contain additional user defined data—the `item` parameter, passed to the view functions, provides a reference to the raw header. Input data for a blog entry could look like so: \n\n    {\n      \"title\": \"Example\",\n      \"description\": \"An example article\",\n      \"template\": \"article.jade\",\n      \"date\": \"2012-03-21\"\n    }\n\n    The content of the example article.\n\nThe end of the header is marked by an empty line. Everything that follows is interpreted as content and is passed to the views untouched.\n\n## Header\n\nJSON at the top of an input file:\n\n    {\n      \"title\": \"Example\",\n      \"description\": \"An example article\",\n      \"template\": \"article.jade\",\n      \"date\": \"2012-03-21\",\n      \"path\": \"2012/03\",\n      \"name\": \"example\"\n    }\n\n* `title` is the title of the page (optional)\n* `description` is the description of the page or rather the post (optional)\n* `template`is the filename of the template to use (required)\n* `date` is the publish date, if not provided it's set to `NOW` (optional)\n* `path` is the output path, if not provided the path of the input file is used (optional)\n* `name` is used as filename of the output file, if not provided the filename of the input file is used (optional)\n\nThe source object, passed to the views, provides a reference to the raw header object. Thus, the header is extendable with arbritrary fields, which can be interpreted by the generators (written by you).\n\nIf you decide to mirror the input paths in your output, you can omit path and name. In that case a typical header of a blog post might look like the following:\n\n    {\n      \"title\": \"Example\",\n      \"description\": \"An example article\",\n      \"template\": \"article.jade\",\n      \"date\": \"2012-03-21\",\n    }\n\nInput data with this header, located at `source_directory/data/posts/2012/03/example.md`, would produce `2012/03/article.html`.\n\nAn input file can consist of just a header (without content) to generate, for example, an RSS feed.\n\n    {\n      \"title\": \"Blog\",\n      \"description\": \"Stuff I write\",\n      \"link\": \"http://my.blog\",\n      \"template\": \"rss.jade\",\n      \"name\": \"rss.xml\"\n    }\n\n## Views\n\nThe views—alternative naming would be: transformers, generators, or bakers—are the functions that generate your artifacts; they have the following signature:\n\n    function (item, callback)\n\nThe passed in 'item' provides the input data to generate the artifact (or most likely the page).\n\nHere, for example, an `item` representing a blog post:\n\n    { header: \n      { title: 'Static Websites',\n        description: '...',\n        template: 'article.jade',\n        data: Thu May 17 2012 02:00:00 GMT +0200 (CEST),\n        path: '2012/05',\n        name: 'static-websites.html' }\n      body: '...', \n      paths: \n      { target: '/tmp/michaelnisi-site',\n        resources: '/Users/michael/workspace/michaelnisi/resources',\n        data: '/Users/michael/workspace/michaelnisi/data',\n        templates: '/Users/michael/workspace/michaelnisi/templates',\n      posts: '/Users/michael/workspace/michaelnisi/data/posts' },\n      title: 'Static Websites',\n      name: 'static-websites.html',\n      date: Thu May 17 2012 02:00:00 GMT+0200 (CEST),\n      templatePath: '/Users/michael/workspace/michaelnisi/templates/article.jade',\n      path: '/tmp/michaelnisi-site/2012/05/static-websites.html',\n      link: '2012/05/static-websites',\n      dateString: 'Thu May 17 2012',\n      bake: [Function],\n      template: <Buffer 0a 20 20 20 20 64 69 76 ...> }\n\nTo see a simple example:\n\n    git clone git://github.com/michaelnisi/blake.git \n    cd blake/example\n    npm install\n    node generate.js\n    open /tmp/blake-site/index.html\n\nTo evaluate a more elaborate example, you might generate my [blog](http://michaelnisi.com), for which I use [Jade](http://jade-lang.com/) and [Markdown](http://daringfireball.net/projects/markdown/):\n\n    npm install -g blake\n    git clone git://github.com/michaelnisi/troubled.git\n    cd troubled\n    npm install\n    blake . /tmp/troubled-site\n    \n## Deployment\n\nOf course you can build your site locally, and upload it to your webserver manually; but I recommend to run blake on a server, using [post-receive hooks](http://help.github.com/post-receive-hooks/) to automatically generate your site, post to each push your input data repository receives.\n\n## Installation\n\nInstall with [npm](http://npmjs.org/):\n\n    npm install blake\n\nTo `blake` from the command-line:\n\n    npm install -g blake\n\n## License\n\n[MIT License](https://raw.github.com/michaelnisi/blake/master/LICENSE)\n",
  "readmeFilename": "README.md",
  "_id": "blake@0.6.5",
  "_from": "blake@0.6.x"
}
