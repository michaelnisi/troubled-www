{
  "name": "blake",
  "version": "0.9.0",
  "description": "Simple, blog aware infrastructure to generate static sites",
  "main": "index.js",
  "directories": {
    "lib": "lib",
    "example": "example",
    "test": "test"
  },
  "scripts": {
    "test": "tap test/*.js"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/michaelnisi/blake.git"
  },
  "bugs": {
    "url": "https://github.com/michaelnisi/blake/issues"
  },
  "keywords": [
    "blog",
    "static",
    "site",
    "generator",
    "infrastructure"
  ],
  "bin": {
    "blake": "bin/cli.js"
  },
  "dependencies": {
    "mkdirp": "0.3.x",
    "fstream": "0.1.x",
    "lru-cache": "2.3.x",
    "prettydate": "0.0.x",
    "event-stream": "3.0.x",
    "cop": "0.3.x",
    "popfun": "0.1.x"
  },
  "devDependencies": {
    "tap": "0.3.x",
    "rimraf": "2.0.x",
    "jade": "0.27.x",
    "markdown": "0.4.x"
  },
  "engines": {
    "node": "0.10.x"
  },
  "author": {
    "name": "Michael Nisi",
    "email": "michael.nisi@gmail.com",
    "url": "http://michaelnisi.com"
  },
  "license": "MIT",
  "readme": "# blake - generate site\n\n[![Build Status](https://travis-ci.org/michaelnisi/blake.png)](http://travis-ci.org/michaelnisi/blake) [![David DM](https://david-dm.org/michaelnisi/blake.png)](http://david-dm.org/michaelnisi/blake)\n\n## Description\n\nThe `blake` [Node.js](http://nodejs.org/) module provides a simple, blog aware infrastructure to generate static sites. For unrestricted choice of input formats and template languages, `blake` confines itself to IO and template routing; it delegates artifact generation to user-written functions.\n\n## CLI Usage\n```\nblake source_directory target_directory\nblake source_directory target_directory source_file ...\n```\nIn the first form, `blake` writes all files generated from input data in the `source_directory` to the `target_directory`. In the second synopsis form, output is generated from the specified source files only.\n\n## Library Usage\n\n### Generate from directory\n```js\nvar blake = require('blake')\n  , source = 'blake-site'\n  , target = '/tmp/blake-site'\n  , join = require('path').join\n  , Reader = require('fstream').Reader\n  , props = { path:join(source, 'data') }\n  , cop = require('cop')\n\nnew Reader(props)\n  .pipe(cop('path'))\n  .pipe(blake(source, target))\n  .pipe(cop(function (filename) { return filename + '\\n' }))\n  .pipe(process.stdout)\n```\n### Copy static resources and generate from directory\n```js    \nvar blake = require('blake')\n  , join = require('path').join\n  , source = join(process.cwd(), './blake-site')\n  , target = '/tmp/blake-site'\n  , Reader = require('fstream').Reader\n  , props = { path:join(source, 'data') }\n  , cop = require('cop')\n  , copy = require('../lib/copy.js')\n\ncopy(join(source, 'resources'), target)\n  .on('error', console.error)\n  .on('end', function () {\n    new Reader(props)\n      .pipe(cop('path'))\n      .pipe(blake(source, target))\n      .pipe(cop(function (filename) { return filename + '\\n' }))\n      .pipe(process.stdout)\n  })\n  .pipe(process.stdout)\n```\n### Generate from files\n```js\nvar blake = require('blake')\n  , cop = require('cop')\n  , readArray = require('event-stream').readArray\n  , filenames = ['first/file', 'second/file', 'third/file']\n  , source = 'source_directory'\n  , target = 'target_directory'\n\nreadArray(filenames)\n  .pipe(blake(source, target))\n  .pipe(cop(function (filename) { return filename + '\\n' }))\n  .pipe(process.stdout)\n```\n### Generate and push to S3\n\nSince the `blake` function returns a [Transform](http://nodejs.org/api/stream.html#stream_class_stream_transform) stream that emits the paths of the generated artifacts, we can pipe to [pushup](https://github.com/michaelnisi/pushup), and upload the files directly to S3.\n```js\nvar resolve = require('path').resolve\n  , cop = require('cop')\n  , getProps = require('pushup/lib/getProps')\n  , blake = require('blake')\n  , pushup = require('pushup')\n  , Reader = require('fstream').Reader\n  , sep = require('path').sep\n  , source = 'source_directory'\n  , target = '/tmp/target_directory'\n  , reader = new Reader({ path:resolve(source, 'data') })\n  , props = getProps()\n\nprocess.chdir(target)\n  \nreader\n  .pipe(cop('path'))\n  .pipe(blake(source, target))\n  .pipe(cop(adjustPath))\n  .pipe(pushup(props))\n  .pipe(process.stdout)\n\nfunction adjustPath (p) {\n  return p.split(sep).slice(3).join(sep)\n}\n```\n## blake(source, target)\n\nThe `blake` module exports a single function that returns a [Transform](http://nodejs.org/api/stream.html#stream_class_stream_transform) stream. While writing source filenames to it, you can read target filenames (of written arfifacts) from it.\n\n- `source` The source directory.\n- `target` The target directory.\n\n## Configuration\n\n`blake` requires a configuration module at `source_directory/config.js`, which exports `paths`, and `views` (a map of generator functions):\n```js\nexports.paths = {\n  data: 'data' \n, templates: 'templates'\n, resources: 'resources'\n, posts: 'data/posts'\n}\n\nexports.views = {\n  'rss.jade': require('./rss.js')\n, 'article.jade': require('./article.js')\n, 'home.jade': require('./home.js')\n, 'about.jade': require('./about.js')\n, 'archive.jade': require('./archive.js')\n}\n```\nThe `paths` object defines input paths, with two required directories: `data` and `templates`. From `data` blake loads general input data, `templates` is the directory for templates. The two optional directories are `resources` and `posts`. The content of `resources` is copied to the `target_directory' unchanged. The `posts` directory hosts blog posts.\n\nThe `views` object is a map of user-written functions that implement the actual generation of output artifacts. Here, these functions are mapped by template name. \n\n## Input\n\nAt the top of each input file blake expects a JSON string that is interpreted as header providing transformation parameters. Besides it can contain additional user defined data—the `item` parameter, passed to the view functions, provides a reference to the raw header. Input data for a blog entry could look like so: \n```\n{\n  \"title\": \"Example\",\n  \"description\": \"An example article\",\n  \"template\": \"article.jade\",\n  \"date\": \"2012-03-21\"\n}\n\nYour highness, when I said that you are like a stream of bat's piss, \nI only mean that you shine out like a shaft of gold when all around \nit is dark.\n```\nThe end of the header is marked by an empty line. Everything that follows is interpreted as content and is passed to the views untouched.\n\n## Header\n\nJSON at the top of an input file:\n```js\n{\n  \"title\": \"Example\",\n  \"description\": \"An example article\",\n  \"template\": \"article.jade\",\n  \"date\": \"2012-03-21\",\n  \"path\": \"2012/03\",\n  \"name\": \"example\"\n}\n```\n* `title` is the title of the page (optional)\n* `description` is the description of the page or rather the post (optional)\n* `template`is the filename of the template to use (required)\n* `date` is the publish date, if not provided it's set to `NOW` (optional)\n* `path` is the output path, if not provided the path of the input file is used (optional)\n* `name` is used as filename of the output file, if not provided the filename of the input file is used (optional)\n\nThe source object, passed to the views, provides a reference to the raw header object. Thus, the header is extendable with arbritrary fields, which can be interpreted by the generators (written by you).\n\nIf you decide to mirror the input paths in your output, you can omit path and name. In that case a typical header of a blog post might look like the following:\n```js\n{\n  \"title\": \"Example\",\n  \"description\": \"An example article\",\n  \"template\": \"article.jade\",\n  \"date\": \"2012-03-21\",\n}\n```\nInput data with this header, located at `source_directory/data/posts/2012/03/example.md`, would produce `2012/03/article.html`.\n\nAn input file can consist of just a header (without content) to generate, for example, an RSS feed.\n```js\n{\n  \"title\": \"Blog\",\n  \"description\": \"Stuff I write\",\n  \"link\": \"http://my.blog\",\n  \"template\": \"rss.jade\",\n  \"name\": \"rss.xml\"\n}\n```\n## Views\n\nThe views—alternative naming would be: transformers, generators, or bakers—are the functions that generate your artifacts; they have the following signature:\n```js\nfunction (item, callback)\n```\nThe passed in 'item' provides the input data to generate the artifact (or most likely the page).\n\nHere, for example, an `item` representing a blog post:\n```js\n{ header: \n  { title: 'Static Websites',\n    description: '...',\n    template: 'article.jade',\n    data: Thu May 17 2012 02:00:00 GMT +0200 (CEST),\n    path: '2012/05',\n    name: 'static-websites.html' }\n  body: '...', \n  paths: \n  { target: '/tmp/michaelnisi-site',\n    resources: '/Users/michael/workspace/michaelnisi/resources',\n    data: '/Users/michael/workspace/michaelnisi/data',\n    templates: '/Users/michael/workspace/michaelnisi/templates',\n  posts: '/Users/michael/workspace/michaelnisi/data/posts' },\n  title: 'Static Websites',\n  name: 'static-websites.html',\n  date: Thu May 17 2012 02:00:00 GMT+0200 (CEST),\n  templatePath: '/Users/michael/workspace/michaelnisi/templates/article.jade',\n  path: '/tmp/michaelnisi-site/2012/05/static-websites.html',\n  link: '2012/05/static-websites',\n  dateString: 'Thu May 17 2012',\n  bake: [Function],\n  template: <Buffer 0a 20 20 20 20 64 69 76 ...> }\n```\nTo see a simple example:\n```\ngit clone git://github.com/michaelnisi/blake.git \ncd blake/example\nnpm install\nnode generate.js\nopen /tmp/blake-site/index.html\n```\nTo evaluate a more elaborate example, you might generate my [blog](http://troubled.pro), for which I use [Jade](http://jade-lang.com/) and [Markdown](http://daringfireball.net/projects/markdown/):\n```\nnpm install -g blake\ngit clone git://github.com/michaelnisi/troubled.git\ncd troubled\nnpm install\nblake . /tmp/troubled-site\n```    \n## Deployment\n\nOf course you can build your site locally, and upload it to your webserver manually; but I recommend to run blake on a server, using [post-receive hooks](http://help.github.com/post-receive-hooks/) to automatically generate your site, post to each push your input data repository receives.\n\n## Installation\n\n[![npm](https://nodei.co/npm/blake.png?compact=true)](https://npmjs.org/package/blake) \n\nTo use the command-line interface:\n```\nnpm install -g blake\n```\n## License\n\n[MIT License](https://raw.github.com/michaelnisi/blake/master/LICENSE)\n",
  "readmeFilename": "README.md",
  "_id": "blake@0.9.0",
  "dist": {
    "shasum": "863a7ef1f8a3f7fe4deb8125924679febab0be6d"
  },
  "_from": "blake@0.9.x",
  "_resolved": "https://registry.npmjs.org/blake/-/blake-0.9.0.tgz"
}
